import{a as L}from"./chunk-V5LPC4OS.js";import"./chunk-RAA6PBRF.js";import{a as z,b as W,c as I,d as T,e as k,f as N,j as V,k as B}from"./chunk-T5VEEF4Z.js";import{B as P,F as C,J as _,K as r,L as i,N as b,O as w,P as g,R as l,S as y,T as x,U as u,V as d,W as m,c as M,da as E,ea as O,ka as v,ma as S,n as p,o as f,p as h,ta as F,w as s}from"./chunk-E6E6T7QQ.js";function A(c,e){if(c&1){let n=b();r(0,"div")(1,"label"),l(2,"Senha:"),i(),r(3,"input",11),m("ngModelChange",function(a){f(n);let t=g();return d(t.password,a)||(t.password=a),h(a)}),i()()}if(c&2){let n=g();s(3),u("ngModel",n.password)}}function D(c,e){if(c&1){let n=b();r(0,"div")(1,"label"),l(2,"Senha Atual (obrigat\xF3ria para alterar senha):"),i(),r(3,"input",12),m("ngModelChange",function(a){f(n);let t=g();return d(t.currentPassword,a)||(t.currentPassword=a),h(a)}),i(),r(4,"label",13),l(5,"Nova Senha (deixe em branco para n\xE3o alterar):"),i(),r(6,"input",14),m("ngModelChange",function(a){f(n);let t=g();return d(t.password,a)||(t.password=a),h(a)}),i()()}if(c&2){let n=g();s(3),u("ngModel",n.currentPassword),s(3),u("ngModel",n.password)}}function R(c,e){if(c&1&&(r(0,"div",15),l(1),i()),c&2){let n=g();s(),x(" ",n.errorMessage," ")}}var q=class c{consultorService=p(L);router=p(S);route=p(v);authService=p(F);consultor={nome:"",email:"",telefone:"",areaEspecializacao:""};password="";currentPassword="";isEditMode=!1;consultorId=null;errorMessage="";ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e&&(this.isEditMode=!0,this.consultorId=e,this.loadConsultor(e))}loadConsultor(e){this.consultorService.getById(e).subscribe({next:n=>{this.consultor=n},error:n=>{console.error("Erro ao carregar consultor:",n),this.errorMessage="Erro ao carregar consultor"}})}submit(){return M(this,null,function*(){if(this.validateForm())if(this.isEditMode&&this.consultorId){if(this.password&&this.password.trim()!==""){if(!this.currentPassword||this.currentPassword.trim()===""){this.errorMessage="Para alterar a senha, \xE9 necess\xE1rio informar a senha atual";return}if(this.password.length<6){this.errorMessage="A nova senha deve ter pelo menos 6 caracteres";return}}this.consultorService.update(this.consultorId,this.consultor).subscribe({next:()=>M(this,null,function*(){if(this.password&&this.password.trim()!==""&&this.currentPassword&&this.currentPassword.trim()!=="")try{yield this.authService.updatePasswordByEmail(this.consultor.email,this.currentPassword,this.password),this.password="",this.currentPassword=""}catch(e){console.error("Erro ao atualizar senha:",e),e.code==="auth/wrong-password"?this.errorMessage="Senha atual incorreta":e.code==="auth/user-not-found"?this.errorMessage="Usu\xE1rio n\xE3o encontrado no Firebase":this.errorMessage=e.message||"Erro ao atualizar senha";return}setTimeout(()=>{this.router.navigate(["/consultores"])},200)}),error:e=>{console.error("Erro ao atualizar consultor:",e),this.errorMessage=e.error?.error||"Erro ao atualizar consultor"}})}else this.authService.register(this.consultor.email,this.password).then(()=>{this.consultorService.create(this.consultor).subscribe({next:()=>{setTimeout(()=>{this.router.navigate(["/consultores"])},200)},error:e=>{console.error("Erro ao criar consultor:",e),this.errorMessage=e.error?.error||"Erro ao criar consultor"}})}).catch(e=>{console.error("Erro ao registrar usu\xE1rio:",e),e.code==="auth/email-already-in-use"?this.errorMessage="Este email j\xE1 est\xE1 sendo usado para login":this.errorMessage=e.message||"Erro ao registrar usu\xE1rio"})})}validateForm(){return this.errorMessage="",!this.consultor.nome||!this.consultor.email||!this.consultor.telefone||!this.consultor.areaEspecializacao?(this.errorMessage="Todos os campos s\xE3o obrigat\xF3rios",!1):!this.isEditMode&&!this.password?(this.errorMessage="Senha \xE9 obrigat\xF3ria",!1):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.consultor.email)?!0:(this.errorMessage="Email inv\xE1lido",!1)}cancel(){this.router.navigate(["/consultores"])}static \u0275fac=function(n){return new(n||c)};static \u0275cmp=P({type:c,selectors:[["app-consultor-form"]],decls:28,vars:9,consts:[[1,"consultor-form-container"],[3,"ngSubmit"],["type","text","name","nome","required","",3,"ngModelChange","ngModel"],["type","email","name","email","required","",3,"ngModelChange","ngModel"],[4,"ngIf"],["type","text","name","telefone","required","",3,"ngModelChange","ngModel"],["type","text","name","areaEspecializacao","required","",3,"ngModelChange","ngModel"],["class","error",4,"ngIf"],[1,"actions"],["type","submit"],["type","button",3,"click"],["type","password","name","password","required","",3,"ngModelChange","ngModel"],["type","password","name","currentPassword","placeholder","Digite a senha atual",3,"ngModelChange","ngModel"],[2,"margin-top","0.5rem"],["type","password","name","password","placeholder","Digite a nova senha",3,"ngModelChange","ngModel"],[1,"error"]],template:function(n,o){n&1&&(r(0,"div",0)(1,"h2"),l(2),i(),r(3,"form",1),w("ngSubmit",function(){return o.submit()}),r(4,"div")(5,"label"),l(6,"Nome Completo:"),i(),r(7,"input",2),m("ngModelChange",function(t){return d(o.consultor.nome,t)||(o.consultor.nome=t),t}),i()(),r(8,"div")(9,"label"),l(10,"Email:"),i(),r(11,"input",3),m("ngModelChange",function(t){return d(o.consultor.email,t)||(o.consultor.email=t),t}),i()(),C(12,A,4,1,"div",4)(13,D,7,2,"div",4),r(14,"div")(15,"label"),l(16,"Telefone:"),i(),r(17,"input",5),m("ngModelChange",function(t){return d(o.consultor.telefone,t)||(o.consultor.telefone=t),t}),i()(),r(18,"div")(19,"label"),l(20,"\xC1rea de Especializa\xE7\xE3o:"),i(),r(21,"input",6),m("ngModelChange",function(t){return d(o.consultor.areaEspecializacao,t)||(o.consultor.areaEspecializacao=t),t}),i()(),C(22,R,2,1,"div",7),r(23,"div",8)(24,"button",9),l(25),i(),r(26,"button",10),w("click",function(){return o.cancel()}),l(27,"Cancelar"),i()()()()),n&2&&(s(2),y(o.isEditMode?"Editar Consultor":"Novo Consultor"),s(5),u("ngModel",o.consultor.nome),s(4),u("ngModel",o.consultor.email),s(),_("ngIf",!o.isEditMode),s(),_("ngIf",o.isEditMode),s(4),u("ngModel",o.consultor.telefone),s(4),u("ngModel",o.consultor.areaEspecializacao),s(),_("ngIf",o.errorMessage),s(3),y(o.isEditMode?"Atualizar":"Criar"))},dependencies:[O,E,B,N,z,W,I,V,k,T],styles:[".consultor-form-container[_ngcontent-%COMP%]{max-width:520px;margin:2.5rem auto;padding:2rem 2.25rem;border-radius:1rem;background-color:#fff;box-shadow:0 8px 30px #0f172a14;box-sizing:border-box;font-family:Poppins,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;color:#183878}.consultor-form-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:1.6rem;font-weight:700;text-align:center;color:#183878}.consultor-form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:1.1rem}.consultor-form-container[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.35rem;font-size:.86rem;letter-spacing:.04em;text-transform:uppercase;color:#526689}.consultor-form-container[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .consultor-form-container[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%], .consultor-form-container[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%]{width:100%;padding:.7rem .85rem;border-radius:.7rem;border:1px solid rgba(148,163,184,.7);color:#526689;font-size:1rem;outline:none;box-sizing:border-box;transition:box-shadow .18s ease,border-color .18s ease,transform .06s ease}.consultor-form-container[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]::placeholder, .consultor-form-container[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%]::placeholder, .consultor-form-container[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%]::placeholder{color:#9ca3af;font-size:.9rem}.consultor-form-container[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]:focus, .consultor-form-container[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%]:focus, .consultor-form-container[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%]:focus{border-color:#183878;box-shadow:0 0 0 1px #1838788c,0 10px 25px #0f172a26;transform:translateY(-1px)}.consultor-form-container[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{margin-top:.3rem;padding:.55rem .7rem;border-radius:.6rem;background:#ef44441f;color:#610808;border:1px solid rgba(248,113,113,.5);font-size:.86rem}.consultor-form-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;margin-top:.5rem}.consultor-form-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;padding:.75rem 1rem;border-radius:.6rem;border:none;cursor:pointer;font-size:.95rem;font-weight:600;text-transform:uppercase;box-sizing:border-box;transition:background .15s ease,color .15s ease,transform .08s ease,box-shadow .15s ease,border-color .15s ease}.consultor-form-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{background-color:#183878;color:#f9fafb;box-shadow:0 2px 18px #07034659}.consultor-form-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background-color:#122f62;transform:translateY(-1px);box-shadow:0 4px 20px #07034666}.consultor-form-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[type=button][_ngcontent-%COMP%]{background-color:#fff;color:#526689;border:1px solid rgba(148,163,184,.9)}.consultor-form-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[type=button][_ngcontent-%COMP%]:hover{background-color:#f3f4f6;color:#183878;box-shadow:0 2px 12px #94a3b859}@media (max-width: 600px){.consultor-form-container[_ngcontent-%COMP%]{margin:1.5rem;padding:1.75rem 1.5rem}.consultor-form-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{flex-direction:column}}"]})};export{q as ConsultorForm};
