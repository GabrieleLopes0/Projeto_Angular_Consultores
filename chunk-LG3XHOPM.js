import{a as B}from"./chunk-6TEKQRSR.js";import"./chunk-RAA6PBRF.js";import{a as F,b as T,c as I,d as z,e as W,f as A,j as k,k as N}from"./chunk-RRQZGJIC.js";import{B as y,F as M,J as _,K as n,L as r,N as x,O as w,P as l,R as c,S as b,T as P,U as g,V as p,W as f,c as h,da as E,ea as v,ka as O,ma as S,n as C,o as m,p as d,ta as V,w as a}from"./chunk-4UB3V42F.js";function U(s,o){s&1&&(n(0,"small",13),c(1," O email n\xE3o pode ser alterado "),r())}function q(s,o){if(s&1){let e=x();n(0,"div")(1,"label"),c(2,"Senha:"),r(),n(3,"input",14),f("ngModelChange",function(t){m(e);let i=l(2);return p(i.password,t)||(i.password=t),d(t)}),r()()}if(s&2){let e=l(2);a(3),g("ngModel",e.password)}}function D(s,o){if(s&1){let e=x();n(0,"div")(1,"label"),c(2,"Senha Atual (obrigat\xF3ria para alterar senha):"),r(),n(3,"input",15),f("ngModelChange",function(t){m(e);let i=l(2);return p(i.currentPassword,t)||(i.currentPassword=t),d(t)}),r(),n(4,"label",16),c(5,"Nova Senha (deixe em branco para n\xE3o alterar):"),r(),n(6,"input",17),f("ngModelChange",function(t){m(e);let i=l(2);return p(i.password,t)||(i.password=t),d(t)}),r()()}if(s&2){let e=l(2);a(3),g("ngModel",e.currentPassword),a(3),g("ngModel",e.password)}}function R(s,o){if(s&1&&(n(0,"div",18),c(1),r()),s&2){let e=l(2);a(),P(" ",e.errorMessage," ")}}function j(s,o){if(s&1){let e=x();n(0,"form",2),w("ngSubmit",function(){m(e);let t=l();return d(t.submit())}),n(1,"div")(2,"label"),c(3,"Nome Completo:"),r(),n(4,"input",3),f("ngModelChange",function(t){m(e);let i=l();return p(i.consultor.nome,t)||(i.consultor.nome=t),d(t)}),r()(),n(5,"div")(6,"label"),c(7,"Email:"),r(),n(8,"input",4),f("ngModelChange",function(t){m(e);let i=l();return p(i.consultor.email,t)||(i.consultor.email=t),d(t)}),r(),M(9,U,2,0,"small",5),r(),M(10,q,4,1,"div",6)(11,D,7,2,"div",6),n(12,"div")(13,"label"),c(14,"Telefone:"),r(),n(15,"input",7),f("ngModelChange",function(t){m(e);let i=l();return p(i.consultor.telefone,t)||(i.consultor.telefone=t),d(t)}),r()(),n(16,"div")(17,"label"),c(18,"\xC1rea de Especializa\xE7\xE3o:"),r(),n(19,"input",8),f("ngModelChange",function(t){m(e);let i=l();return p(i.consultor.areaEspecializacao,t)||(i.consultor.areaEspecializacao=t),d(t)}),r()(),M(20,R,2,1,"div",9),n(21,"div",10)(22,"button",11),c(23),r(),n(24,"button",12),w("click",function(){m(e);let t=l();return d(t.cancel())}),c(25,"Cancelar"),r()()()}if(s&2){let e=l();a(4),g("ngModel",e.consultor.nome),a(4),g("ngModel",e.consultor.email),_("disabled",e.isEditMode&&!e.isAdmin),a(),_("ngIf",e.isEditMode&&!e.isAdmin),a(),_("ngIf",!e.isEditMode),a(),_("ngIf",e.isEditMode),a(4),g("ngModel",e.consultor.telefone),a(4),g("ngModel",e.consultor.areaEspecializacao),a(),_("ngIf",e.errorMessage),a(3),b(e.isEditMode?"Atualizar":"Criar")}}var L=class s{consultorService=C(B);router=C(S);route=C(O);authService=C(V);consultor={nome:"",email:"",telefone:"",areaEspecializacao:""};password="";currentPassword="";isEditMode=!1;consultorId=null;errorMessage="";isAdmin=!1;currentUserEmail=null;canEditThisConsultor=!0;ngOnInit(){return h(this,null,function*(){this.isAdmin=yield this.authService.isAdmin(),this.currentUserEmail=yield this.authService.getCurrentUserEmail();let o=this.route.snapshot.paramMap.get("id");o?(this.isEditMode=!0,this.consultorId=o,this.loadConsultor(o)):this.isAdmin||(this.errorMessage="Apenas administradores podem criar novos consultores",setTimeout(()=>{this.router.navigate(["/consultores"])},2e3))})}loadConsultor(o){this.consultorService.getById(o).subscribe({next:e=>h(this,null,function*(){this.consultor=e,!this.isAdmin&&this.consultor.email!==this.currentUserEmail&&(this.errorMessage="Voc\xEA s\xF3 pode editar seu pr\xF3prio perfil",this.canEditThisConsultor=!1,setTimeout(()=>{this.router.navigate(["/consultores"])},2e3))}),error:e=>{console.error("Erro ao carregar consultor:",e),this.errorMessage="Erro ao carregar consultor"}})}submit(){return h(this,null,function*(){if(this.canEditThisConsultor&&this.validateForm()){if(!this.isAdmin&&this.isEditMode&&this.consultor.email!==this.currentUserEmail){this.errorMessage="Voc\xEA s\xF3 pode editar seu pr\xF3prio perfil";return}if(this.isEditMode&&this.consultorId){if(this.password&&this.password.trim()!==""){if(!this.currentPassword||this.currentPassword.trim()===""){this.errorMessage="Para alterar a senha, \xE9 necess\xE1rio informar a senha atual";return}if(this.password.length<6){this.errorMessage="A nova senha deve ter pelo menos 6 caracteres";return}}this.consultorService.update(this.consultorId,this.consultor).subscribe({next:()=>h(this,null,function*(){if(this.password&&this.password.trim()!==""&&this.currentPassword&&this.currentPassword.trim()!=="")try{yield this.authService.updatePasswordByEmail(this.consultor.email,this.currentPassword,this.password),this.password="",this.currentPassword=""}catch(o){console.error("Erro ao atualizar senha:",o),o.code==="auth/wrong-password"?this.errorMessage="Senha atual incorreta":o.code==="auth/user-not-found"?this.errorMessage="Usu\xE1rio n\xE3o encontrado no Firebase":this.errorMessage=o.message||"Erro ao atualizar senha";return}setTimeout(()=>{this.router.navigate(["/consultores"])},200)}),error:o=>{console.error("Erro ao atualizar consultor:",o),this.errorMessage=o.error?.error||"Erro ao atualizar consultor"}})}else this.authService.register(this.consultor.email,this.password).then(()=>{this.consultorService.create(this.consultor).subscribe({next:()=>{this.router.navigate(["/consultores"])},error:o=>{console.error("Erro ao criar consultor:",o),this.errorMessage=o.error?.error||"Erro ao criar consultor"}})}).catch(o=>{console.error("Erro ao registrar usu\xE1rio:",o),o.code==="auth/email-already-in-use"?this.errorMessage="Este email j\xE1 est\xE1 sendo usado para login":this.errorMessage=o.message||"Erro ao registrar usu\xE1rio"})}})}validateForm(){return this.errorMessage="",!this.consultor.nome||!this.consultor.email||!this.consultor.telefone||!this.consultor.areaEspecializacao?(this.errorMessage="Todos os campos s\xE3o obrigat\xF3rios",!1):!this.isEditMode&&!this.password?(this.errorMessage="Senha \xE9 obrigat\xF3ria",!1):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.consultor.email)?!0:(this.errorMessage="Email inv\xE1lido",!1)}cancel(){this.router.navigate(["/consultores"])}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=y({type:s,selectors:[["app-consultor-form"]],decls:4,vars:2,consts:[[1,"consultor-form-container"],[3,"ngSubmit",4,"ngIf"],[3,"ngSubmit"],["type","text","name","nome","required","",3,"ngModelChange","ngModel"],["type","email","name","email","required","",3,"ngModelChange","ngModel","disabled"],["style","color: #6b7280; display: block; margin-top: 0.25rem;",4,"ngIf"],[4,"ngIf"],["type","text","name","telefone","required","",3,"ngModelChange","ngModel"],["type","text","name","areaEspecializacao","required","",3,"ngModelChange","ngModel"],["class","error",4,"ngIf"],[1,"actions"],["type","submit"],["type","button",3,"click"],[2,"color","#6b7280","display","block","margin-top","0.25rem"],["type","password","name","password","required","",3,"ngModelChange","ngModel"],["type","password","name","currentPassword","placeholder","Digite a senha atual",3,"ngModelChange","ngModel"],[2,"margin-top","0.5rem"],["type","password","name","password","placeholder","Digite a nova senha",3,"ngModelChange","ngModel"],[1,"error"]],template:function(e,u){e&1&&(n(0,"div",0)(1,"h2"),c(2),r(),M(3,j,26,10,"form",1),r()),e&2&&(a(2),b(u.isEditMode?"Editar Consultor":"Novo Consultor"),a(),_("ngIf",u.canEditThisConsultor))},dependencies:[v,E,N,A,F,T,I,k,W,z],styles:[".consultor-form-container[_ngcontent-%COMP%]{max-width:520px;margin:2.5rem auto;padding:2rem 2.25rem;border-radius:1rem;background-color:#fff;box-shadow:0 8px 30px #0f172a14;box-sizing:border-box;font-family:Poppins,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;color:#183878}.consultor-form-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:1.6rem;font-weight:700;text-align:center;color:#183878}.consultor-form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:1.1rem}.consultor-form-container[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.35rem;font-size:.86rem;letter-spacing:.04em;text-transform:uppercase;color:#526689}.consultor-form-container[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .consultor-form-container[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%], .consultor-form-container[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%]{width:100%;padding:.7rem .85rem;border-radius:.7rem;border:1px solid rgba(148,163,184,.7);color:#526689;font-size:1rem;outline:none;box-sizing:border-box;transition:box-shadow .18s ease,border-color .18s ease,transform .06s ease}.consultor-form-container[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]::placeholder, .consultor-form-container[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%]::placeholder, .consultor-form-container[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%]::placeholder{color:#9ca3af;font-size:.9rem}.consultor-form-container[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]:focus, .consultor-form-container[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%]:focus, .consultor-form-container[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%]:focus{border-color:#183878;box-shadow:0 0 0 1px #1838788c,0 10px 25px #0f172a26;transform:translateY(-1px)}.consultor-form-container[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{margin-top:.3rem;padding:.55rem .7rem;border-radius:.6rem;background:#ef44441f;color:#610808;border:1px solid rgba(248,113,113,.5);font-size:.86rem}.consultor-form-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;margin-top:.5rem}.consultor-form-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;padding:.75rem 1rem;border-radius:.6rem;border:none;cursor:pointer;font-size:.95rem;font-weight:600;text-transform:uppercase;box-sizing:border-box;transition:background .15s ease,color .15s ease,transform .08s ease,box-shadow .15s ease,border-color .15s ease}.consultor-form-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{background-color:#183878;color:#f9fafb;box-shadow:0 2px 18px #07034659}.consultor-form-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background-color:#122f62;transform:translateY(-1px);box-shadow:0 4px 20px #07034666}.consultor-form-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[type=button][_ngcontent-%COMP%]{background-color:#fff;color:#526689;border:1px solid rgba(148,163,184,.9)}.consultor-form-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[type=button][_ngcontent-%COMP%]:hover{background-color:#f3f4f6;color:#183878;box-shadow:0 2px 12px #94a3b859}@media (max-width: 600px){.consultor-form-container[_ngcontent-%COMP%]{margin:1.5rem;padding:1.75rem 1.5rem}.consultor-form-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{flex-direction:column}}"]})};export{L as ConsultorForm};
