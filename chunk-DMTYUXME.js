import{a as R}from"./chunk-HGYMROOT.js";import"./chunk-RAA6PBRF.js";import{a as L,b as F,e as N,g as D,h as V,i as z,k as U}from"./chunk-LW2YUVVW.js";import{C as v,G as m,K as u,L as r,M as i,O as b,P as g,Q as d,S as a,T as _,V as M,W as O,X as x,c as f,da as w,ea as E,fa as S,i as P,ka as y,la as k,na as A,o as p,p as C,pa as T,q as h,ua as I,x as l}from"./chunk-MSOPY6SM.js";function j(s,e){if(s&1){let t=b();r(0,"button",14),g("click",function(){C(t);let n=d();return h(n.newConsultor())}),a(1," Novo Consultor "),i()}}function W(s,e){if(s&1){let t=b();r(0,"button",14),g("click",function(){C(t);let n=d();return h(n.editOwnProfile())}),a(1," Meu Perfil "),i()}}function q(s,e){if(s&1&&(r(0,"option",15),a(1),i()),s&2){let t=e.$implicit;u("value",t),l(),_(t)}}function $(s,e){s&1&&(r(0,"div",16),a(1,"Carregando..."),i())}function Y(s,e){if(s&1){let t=b();r(0,"button",2),g("click",function(){C(t);let n=d().$implicit,c=d(2);return h(c.editConsultor(n._id))}),a(1," Editar "),i()}}function G(s,e){if(s&1){let t=b();r(0,"button",2),g("click",function(){C(t);let n=d().$implicit,c=d(2);return h(c.deleteConsultor(n._id))}),a(1," Excluir "),i()}}function H(s,e){if(s&1&&(r(0,"tr")(1,"td"),a(2),i(),r(3,"td"),a(4),i(),r(5,"td"),a(6),i(),r(7,"td"),a(8),i(),r(9,"td"),a(10),i(),r(11,"td"),m(12,Y,2,0,"button",19)(13,G,2,0,"button",19),i()()),s&2){let t=e.$implicit,o=d(2);l(2),_(t.nome),l(2),_(t.email),l(2),_(t.telefone),l(2),_(t.areaEspecializacao),l(2),_(o.formatDate(t.dataCadastro||t.createdAt)),l(2),u("ngIf",o.canEdit(t)),l(),u("ngIf",o.canDelete(t))}}function K(s,e){if(s&1&&(r(0,"div",17)(1,"table")(2,"thead")(3,"tr")(4,"th"),a(5,"Nome"),i(),r(6,"th"),a(7,"Email"),i(),r(8,"th"),a(9,"Telefone"),i(),r(10,"th"),a(11,"\xC1rea"),i(),r(12,"th"),a(13,"Data Cadastro"),i(),r(14,"th"),a(15,"A\xE7\xF5es"),i()()(),r(16,"tbody"),m(17,H,14,7,"tr",18),i()()()),s&2){let t=d();l(17),u("ngForOf",t.filteredConsultores)}}function J(s,e){s&1&&(r(0,"div",20)(1,"p"),a(2,"Nenhum consultor encontrado"),i()())}var B=class s{consultorService=p(R);authService=p(I);router=p(A);route=p(k);routerSubscription;consultores=[];filteredConsultores=[];busca="";areaFiltro="";areas=[];loading=!1;allConsultores=[];isAdmin=!1;currentUserEmail=null;ngOnInit(){return f(this,null,function*(){yield this.checkPermissions(),this.refreshData(),this.routerSubscription=this.router.events.pipe(P(e=>e instanceof y)).subscribe(e=>f(this,null,function*(){let t=e.urlAfterRedirects||e.url;(t==="/consultores"||t.startsWith("/consultores"))&&(yield this.checkPermissions(),setTimeout(()=>{this.refreshData()},50))}))})}checkPermissions(){return f(this,null,function*(){try{let e=this.authService.getCurrentUser();e&&(yield e.getIdToken(!0)),this.isAdmin=yield this.authService.isAdmin(),this.currentUserEmail=yield this.authService.getCurrentUserEmail(),console.log("Permiss\xF5es verificadas - isAdmin:",this.isAdmin,"email:",this.currentUserEmail)}catch(e){console.error("Erro ao verificar permiss\xF5es:",e),this.isAdmin=!1,this.currentUserEmail=yield this.authService.getCurrentUserEmail()}})}refreshData(){this.loadAllAreas(),this.loadConsultores()}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe()}loadAllAreas(){this.consultorService.getAll().subscribe({next:e=>{this.allConsultores=e||[],this.extractAreas()},error:e=>{console.error("Erro ao carregar \xE1reas:",e),this.allConsultores=[],this.areas=[]}})}loadConsultores(e=0){this.loading=!0,this.consultorService.getAll(this.busca,this.areaFiltro).subscribe({next:t=>{this.consultores=t,this.filteredConsultores=t,this.loading=!1},error:t=>{let o=this.consultorService.apiUrl||"N/A";if(console.error("Erro ao carregar consultores:",t),console.error("URL tentada:",t.url||o),console.error("Status:",t.status||"N/A"),t.status===503&&e<3&&o.includes("onrender.com")){console.log(`Tentativa ${e+1}/3: Backend iniciando, aguardando 5 segundos...`),this.loading=!1,setTimeout(()=>{this.loadConsultores(e+1)},5e3);return}this.loading=!1,this.consultores=[],this.filteredConsultores=[];let n=`Erro ao conectar com o servidor.

`;n+=`URL: ${o}

`,t.status===0||!t.status?o.includes("localhost")?(n+=`O backend local n\xE3o est\xE1 respondendo.
`,n+=`Verifique se o backend est\xE1 rodando:
`,n+=`1. Abra um terminal
`,n+=`2. cd backend
`,n+=`3. npm start
`,n+=`
O backend deve estar em: http://localhost:3001`):(n+=`O backend remoto n\xE3o est\xE1 respondendo.
`,n+=`Verifique se o backend no Render est\xE1 online:
`,n+="https://projeto-angular-consultores.onrender.com"):t.status===500?n+=`Erro no servidor (500).
Verifique os logs do backend.`:t.status===404?n+=`Endpoint n\xE3o encontrado (404).
Verifique a URL da API.`:t.status===401?n+=`N\xE3o autorizado (401).
Fa\xE7a login novamente.`:t.status===503?(n+=`Servi\xE7o temporariamente indispon\xEDvel (503).
`,n+=`O backend no Render est\xE1 iniciando (pode levar 30-60 segundos).
`,n+="Aguarde alguns segundos e recarregue a p\xE1gina."):n+=`Erro HTTP ${t.status}: ${t.message||"Erro desconhecido"}`,alert(n)}})}extractAreas(){let e=new Set;this.allConsultores.forEach(t=>{t.areaEspecializacao&&t.areaEspecializacao.trim()!==""&&e.add(t.areaEspecializacao.trim())}),this.areas=Array.from(e).sort(),console.log("\xC1reas extra\xEDdas:",this.areas)}onBuscaChange(){this.loadConsultores()}onAreaChange(){this.loadConsultores()}deleteConsultor(e){confirm("Tem certeza que deseja excluir este consultor? A credencial do Firebase tamb\xE9m ser\xE1 removida.")&&this.consultorService.delete(e).subscribe({next:t=>{this.loadAllAreas(),this.loadConsultores(),t?.warning&&alert(`\u26A0\uFE0F Consultor exclu\xEDdo, mas a credencial do Firebase pode ainda existir.

Configure o Firebase Admin SDK no backend para exclus\xE3o autom\xE1tica.
Veja: backend/CONFIGURAR_FIREBASE_ADMIN.md`)},error:t=>{console.error("Erro ao excluir consultor:",t),alert("Erro ao excluir consultor")}})}editConsultor(e){this.router.navigate(["/consultores/editar",e])}editOwnProfile(){return f(this,null,function*(){if(!this.currentUserEmail)return;let e=this.consultores.find(t=>t.email===this.currentUserEmail);e&&e._id?this.router.navigate(["/consultores/editar",e._id]):alert("Seu perfil n\xE3o foi encontrado. Entre em contato com um administrador.")})}newConsultor(){this.router.navigate(["/consultores/novo"])}canEdit(e){return this.isAdmin?!0:e.email===this.currentUserEmail}canDelete(e){return this.isAdmin}logout(){this.authService.logout()}formatDate(e){if(!e)return"";let t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=v({type:s,selectors:[["app-consultores-list"]],decls:20,vars:8,consts:[[1,"consultores-list-container"],[1,"header"],[3,"click"],[1,"actions"],[1,"action-buttons"],["class","button_novo_consultor",3,"click",4,"ngIf"],[1,"filters"],["type","text","placeholder","Buscar por nome ou email...",3,"ngModelChange","input","ngModel"],[3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","loading",4,"ngIf"],["class","table-responsive",4,"ngIf"],["class","no-data",4,"ngIf"],[1,"button_novo_consultor",3,"click"],[3,"value"],[1,"loading"],[1,"table-responsive"],[4,"ngFor","ngForOf"],[3,"click",4,"ngIf"],[1,"no-data"]],template:function(t,o){t&1&&(r(0,"div",0)(1,"div",1)(2,"h1"),a(3,"Consultores"),i(),r(4,"button",2),g("click",function(){return o.logout()}),a(5,"Sair"),i()(),r(6,"div",3)(7,"div",4),m(8,j,2,0,"button",5)(9,W,2,0,"button",5),i(),r(10,"div",6)(11,"input",7),x("ngModelChange",function(c){return O(o.busca,c)||(o.busca=c),c}),g("input",function(){return o.onBuscaChange()}),i(),r(12,"select",8),x("ngModelChange",function(c){return O(o.areaFiltro,c)||(o.areaFiltro=c),c}),g("change",function(){return o.onAreaChange()}),r(13,"option",9),a(14,"Todas as \xE1reas"),i(),m(15,q,2,2,"option",10),i()()(),r(16,"div",0),m(17,$,2,0,"div",11)(18,K,18,1,"div",12),i(),m(19,J,3,0,"div",13),i()),t&2&&(l(8),u("ngIf",o.isAdmin),l(),u("ngIf",!o.isAdmin),l(2),M("ngModel",o.busca),l(),M("ngModel",o.areaFiltro),l(3),u("ngForOf",o.areas),l(2),u("ngIf",o.loading),l(),u("ngIf",!o.loading&&o.filteredConsultores.length>0),l(),u("ngIf",!o.loading&&o.filteredConsultores.length===0))},dependencies:[S,w,E,T,U,V,z,L,D,F,N],styles:[".consultores-list-container[_ngcontent-%COMP%]{max-width:1100px;margin:2.5rem auto;padding:2rem 2.5rem;box-sizing:border-box;background-color:#fff;border-radius:1rem;box-shadow:0 8px 30px #0f172a14;font-family:Poppins;color:#183878}.consultores-list-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem}.consultores-list-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.8rem;font-weight:700;color:#183878}.table-responsive[_ngcontent-%COMP%]{width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch}.consultores-list-container[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .consultores-list-container[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{white-space:nowrap;min-width:100px}.consultores-list-container[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{min-width:150px}.consultores-list-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.55rem 1.1rem;border-radius:.6rem;border:1px solid rgba(148,163,184,.9);background-color:#fff;color:#526689;font-size:.85rem;font-weight:600;text-transform:uppercase;cursor:pointer;transition:background .15s ease,color .15s ease,box-shadow .15s ease}.consultores-list-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#f3f4f6;color:#183878;box-shadow:0 2px 10px #94a3b859}.consultores-list-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:1.5rem}.button_novo_consultor[_ngcontent-%COMP%]{padding:.7rem 1.4rem;border-radius:.6rem;border:none;background-color:#183878;color:#f9fafb;font-size:.9rem;font-weight:600;text-transform:uppercase;cursor:pointer;box-shadow:0 2px 18px #07034659;transition:background .15s ease,transform .08s ease,box-shadow .15s ease}.button_novo_consultor[_ngcontent-%COMP%]:hover{background-color:#122f62;transform:translateY(-1px);box-shadow:0 4px 20px #07034666}.consultores-list-container[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;flex-wrap:wrap}.consultores-list-container[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .consultores-list-container[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.55rem .8rem;border-radius:.6rem;border:1px solid rgba(148,163,184,.9);font-size:.9rem;color:#526689;min-width:180px;outline:none;box-sizing:border-box;transition:box-shadow .15s ease,border-color .15s ease}.consultores-list-container[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .consultores-list-container[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#183878;box-shadow:0 0 0 1px #18387880}.consultores-list-container[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%], .consultores-list-container[_ngcontent-%COMP%]   .no-data[_ngcontent-%COMP%]{margin-top:1rem;font-size:.95rem;color:#526689}.consultores-list-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:.5rem;font-size:.9rem}.consultores-list-container[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:#f3f4f6}.consultores-list-container[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .consultores-list-container[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem .8rem;text-align:left}.consultores-list-container[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;color:#526689;text-transform:uppercase;font-size:.78rem;border-bottom:1px solid rgba(209,213,219,.9)}.consultores-list-container[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid rgba(229,231,235,.9)}.consultores-list-container[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f9fafb}.consultores-list-container[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#eef2ff}.consultores-list-container[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.4rem .8rem;border-radius:.5rem;border:none;font-size:.8rem;font-weight:600;text-transform:uppercase;cursor:pointer;margin-right:.4rem;transition:background .15s ease,transform .08s ease,box-shadow .15s ease}.consultores-list-container[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{background-color:#e5efff;color:#183878}.consultores-list-container[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child:hover{background-color:#d1ddff;transform:translateY(-1px)}.consultores-list-container[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{background-color:#fee2e2;color:#7f1d1d}.consultores-list-container[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child:hover{background-color:#fecaca;transform:translateY(-1px)}@media (max-width: 768px){.consultores-list-container[_ngcontent-%COMP%]{padding:1.5rem}.consultores-list-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:1.5rem}.consultores-list-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:flex-start}.button_novo_consultor[_ngcontent-%COMP%]{flex-grow:1;text-align:center}.consultores-list-container[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{width:100%}.consultores-list-container[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .consultores-list-container[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{flex:1;min-width:0}.consultores-list-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{font-size:.85rem}}"]})};export{B as ConsultoresList};
